<!-- templates/quejas/mis_quejas.html -->
{% extends "base.html" %}
{% block title %}Mis Quejas - NEOTOWER{% endblock %}

{% block content %}
<style>
:root {
    --primary-blue: #2563eb;
    --mint-green: #10b981;
    --dark-black: #1f2937;
    --light-mint: #d1fae5;
    --gradient-bg: linear-gradient(135deg, var(--primary-blue) 0%, var(--mint-green) 100%);
}

body {
    background: linear-gradient(135deg, #eef7ff 0%, #fafff8 100%);
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

h2 {
    color: var(--dark-black);
    font-weight: 700;
    text-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.card-custom {
    background: rgba(255, 255, 255, 0.95);
    border: none;
    border-radius: 18px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    overflow: hidden;
}

.card-header-custom {
    background: var(--gradient-bg);
    color: white;
    padding: 25px;
    border-radius: 18px 18px 0 0;
}

.btn-primary {
    background: var(--gradient-bg);
    border: none;
    border-radius: 10px;
    font-weight: 600;
    color: white;
    transition: all 0.3s ease;
}
.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
}

.btn-outline-light {
    border: 2px solid white;
    color: white;
    font-weight: 500;
    border-radius: 10px;
}
.btn-outline-light:hover {
    background: white;
    color: var(--primary-blue);
}

.card-inner {
    background: rgba(255,255,255,0.9);
    border-radius: 15px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    transition: transform 0.2s ease;
}
.card-inner:hover {
    transform: translateY(-3px);
}

.badge {
    border-radius: 8px;
    font-size: 0.8rem;
    padding: 0.4em 0.6em;
}

.badge-estado-pendiente { background-color: var(--primary-blue); color: #fff; }
.badge-estado-en_proceso { background-color: #facc15; color: #000; }
.badge-estado-respondida { background-color: #22c55e; color: #fff; }
.badge-estado-resuelta { background-color: #6b7280; color: #fff; }

.badge-prioridad-urgente { background-color: #dc2626; color: #fff; }
.badge-prioridad-alta { background-color: #f97316; color: #fff; }
.badge-prioridad-media { background-color: var(--primary-blue); color: #fff; }
.badge-prioridad-baja { background-color: #9ca3af; color: #fff; }

.bg-response {
    background-color: rgba(16, 185, 129, 0.1);
    border-left: 4px solid var(--mint-green);
    border-radius: 8px;
    padding: 12px 16px;
}
</style>

<div class="container py-4">
  <div class="card-custom">
    <div class="card-header-custom d-flex justify-content-between align-items-center flex-wrap">
      <h2 class="mb-0"><i class="bi bi-chat-dots me-2"></i>Mis Quejas y Sugerencias</h2>
      <div class="mt-3 mt-md-0">
        <a href="{{ url_for('buzon.nueva_queja') }}" class="btn btn-light me-2">
          <i class="bi bi-plus-circle me-1"></i> Nuevo Mensaje
        </a>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-light">
          <i class="bi bi-house me-1"></i> Dashboard
        </a>
      </div>
    </div>

    <div class="card-body p-4">
      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% if quejas %}
        {% for queja in quejas %}
        <div class="card-inner p-4 mb-4">
          <div class="d-flex justify-content-between align-items-start flex-wrap">
            <h5 class="fw-bold mb-2">
              <i class="bi 
                {% if queja.tipo == 'sugerencia' %}bi-lightbulb text-info
                {% elif queja.tipo == 'queja' %}bi-exclamation-triangle text-warning
                {% elif queja.tipo == 'reclamo' %}bi-flag text-danger
                {% else %}bi-hand-thumbs-up text-success{% endif %} me-2"></i>
              {{ queja.asunto or 'Sin asunto' }}
            </h5>
            <div class="mb-2">
              <span class="badge 
                {% if queja.estado == 'pendiente' %}badge-estado-pendiente
                {% elif queja.estado == 'en_proceso' %}badge-estado-en_proceso
                {% elif queja.estado == 'respondida' %}badge-estado-respondida
                {% else %}badge-estado-resuelta{% endif %} me-1">
                {{ queja.estado|replace('_',' ')|title }}
              </span>
              <span class="badge bg-secondary">{{ queja.tipo|title }}</span>
            </div>
          </div>

          <p class="text-muted mt-2 mb-3" style="white-space: pre-line;">{{ queja.descripcion or 'Sin descripción' }}</p>

          <div class="row small text-muted mb-2">
            <div class="col-md-4 mb-2">
              <i class="bi bi-flag me-1"></i><strong>Prioridad:</strong>
              <span class="badge 
                {% if queja.prioridad == 'urgente' %}badge-prioridad-urgente
                {% elif queja.prioridad == 'alta' %}badge-prioridad-alta
                {% elif queja.prioridad == 'media' %}badge-prioridad-media
                {% else %}badge-prioridad-baja{% endif %} ms-1">
                {{ queja.prioridad|title }}
              </span>
            </div>
            <div class="col-md-4 mb-2">
              <i class="bi bi-calendar me-1"></i><strong>Enviado:</strong>
              {{ queja.fecha_creacion.strftime('%d/%m/%Y %H:%M') if queja.fecha_creacion else 'N/A' }}
            </div>
            <div class="col-md-4 mb-2">
              <i class="bi bi-person me-1"></i><strong>Modo:</strong>
              {% if queja.anonimo %}
              <span class="badge bg-secondary">Anónimo</span>
              {% else %}
              <span class="badge bg-primary">Público</span>
              {% endif %}
            </div>
          </div>

          {% if queja.respuesta %}
          <div class="bg-response mt-3">
            <h6 class="text-success mb-2"><i class="bi bi-reply me-1"></i>Respuesta de la administración:</h6>
            <p class="mb-1" style="white-space: pre-line;">{{ queja.respuesta }}</p>
            {% if queja.fecha_respuesta %}
            <small class="text-muted">Respondido el: {{ queja.fecha_respuesta.strftime('%d/%m/%Y %H:%M') }}</small>
            {% endif %}
          </div>
          {% endif %}

          <div class="mt-3 text-end">
            <a href="{{ url_for('buzon.detalle_queja', id_queja=queja.id_queja) }}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-eye me-1"></i> Ver Detalles
            </a>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="text-center py-5">
          <i class="bi bi-chat-dots display-1 text-muted mb-3"></i>
          <h4 class="text-muted mb-2">No has enviado ningún mensaje</h4>
          <p class="text-muted mb-4">Tu buzón de quejas y sugerencias está vacío.</p>
          <a href="{{ url_for('buzon.nueva_queja') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>Enviar tu primer mensaje
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
