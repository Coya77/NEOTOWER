{% extends "base.html" %}
{% block title %}Calendario de Reservas{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-calendar3"></i> Calendario de Reservas</h2>
    <a href="{{ url_for('gestion_reservas') }}" class="btn btn-secondary">
      <i class="bi bi-arrow-left-circle"></i> Volver
    </a>
  </div>

  <!-- Calendario -->
  <div id="calendar" style="max-width: 100%; margin: 0 auto;"></div>
</div>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    height: '80vh',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
    },
    locale: 'es',
    events: [
      {% for r in reservas %}
      {
        title: '{{ r.tipo }} - {{ r.nombre }} {{ r.apellido }}',
        start: '{{ r.fecha_inicio }}',
        end: '{{ r.fecha_fin }}',
        backgroundColor: '{% if r.estado == "confirmada" %}#198754{% elif r.estado == "pendiente" %}#ffc107{% else %}#dc3545{% endif %}',
        borderColor: '#000',
        extendedProps: {
          descripcion: '{{ r.descripcion|replace("\n", " ")|replace("\r", "") }}',
          horario: '{{ r.horario }}',
          personas: '{{ r.numero_personas }}',
          costo: '{{ r.costo_reserva }}'
        }
      },
      {% endfor %}
    ],
    eventClick: function(info) {
      const r = info.event.extendedProps;
      alert(
        "ğŸ“… Reserva: " + info.event.title +
        "\nğŸ•“ Horario: " + r.horario +
        "\nğŸ‘¥ Personas: " + r.personas +
        "\nğŸ’° Costo: Bs. " + r.costo +
        "\nğŸ“ DescripciÃ³n: " + r.descripcion
      );
    }
  });

  calendar.render();
});
</script>
{% endblock %}
