{% extends "base.html" %}
{% block title %}Gesti√≥n de Reservas{% endblock %}
{% block content %}

<div class="container mt-4">
  <!-- üîπ Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="text-primary mb-0"><i class="bi bi-calendar2-check"></i> Gesti√≥n de Reservas</h3>
    <a href="{{ url_for('gestion_reservas') }}" class="btn btn-outline-primary btn-sm">

      <i class="bi bi-arrow-clockwise"></i> Actualizar
    </a>
  </div>

  <!-- üîπ Tabla de reservas -->
  <div class="table-responsive shadow-sm">
    <table class="table table-striped align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Residente</th>
          <th>Ambiente</th>
          <th>Fecha</th>
          <th>Horario</th>
          <th>Personas</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        {% if reservas %}
          {% for r in reservas %}
          <tr>
            <td>{{ r.id_reserva }}</td>
            <td>{{ r.residente }}</td>
            <td>{{ r.tipo }}</td>
            <td>{{ r.fecha_inicio.strftime('%d/%m/%Y') }}</td>
            <td>{{ r.horario }}</td>
            <td>{{ r.numero_personas }}</td>

            <!-- üîπ Estado visual -->
            <td>
              {% if r.estado == 'pendiente' %}
                <span class="badge bg-warning text-dark">Pendiente</span>
              {% elif r.estado == 'confirmada' %}
                <span class="badge bg-success">Confirmada</span>
              {% elif r.estado == 'cancelada' %}
                <span class="badge bg-danger">Cancelada</span>
              {% elif r.estado == 'solicitud_cancelacion' %}
                <span class="badge bg-secondary">Solicitud Cancelaci√≥n</span>
              {% elif r.estado == 'entregado' %}
                <span class="badge bg-info text-dark">Entregado</span>
              {% else %}
                <span class="badge bg-dark">Otro</span>
              {% endif %}
            </td>

            <!-- üîπ Acciones -->
            <td class="text-center">
             <a href="{{ url_for('detalle_reserva_admin', id_reserva=r.id_reserva) }}" 
   class="btn btn-sm btn-info mb-1">
  <i class="bi bi-eye"></i> Ver
</a>

              <!-- Acciones segun estado -->
              {% if r.estado == 'pendiente' %}
                <form action="{{ url_for('admin_aprobar_reserva', id_reserva=r.id_reserva) }}" method="POST" class="d-inline">
                  <button class="btn btn-sm btn-success mb-1">
                    <i class="bi bi-check-circle"></i> Aprobar
                  </button>
                </form>
                <form action="{{ url_for('admin_rechazar_reserva', id_reserva=r.id_reserva) }}" method="POST" class="d-inline">
                  <button class="btn btn-sm btn-danger mb-1">
                    <i class="bi bi-x-circle"></i> Rechazar
                  </button>
                </form>

              {% elif r.estado == 'solicitud_cancelacion' %}
                <form action="{{ url_for('admin_aceptar_cancelacion', id_reserva=r.id_reserva) }}" method="POST" class="d-inline">
                  <button class="btn btn-sm btn-warning mb-1">
                    <i class="bi bi-exclamation-triangle"></i> Aceptar Cancelaci√≥n
                  </button>
                </form>

              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="8" class="text-center text-muted">No hay reservas registradas.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
